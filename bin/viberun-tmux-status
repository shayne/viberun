#!/bin/sh
set -eu

mode="${1:-}"
app="${VIBERUN_APP:-}"
agent="${VIBERUN_AGENT:-}"
port="${VIBERUN_HOST_PORT:-}"

case "$mode" in
  left)
    label="viberun"
    if [ -n "$app" ]; then
      label="$label $app"
    fi
    printf "%s" "$label"
    ;;
  right)
    if [ -z "$port" ]; then
      printf "ctrl-\\ to detach"
      exit 0
    fi
    if command -v ss >/dev/null 2>&1; then
      if ss -ltn 2>/dev/null | grep -q ":8080 "; then
        printf "http://localhost:%s  ctrl-\\ to detach" "$port"
      fi
    elif command -v netstat >/dev/null 2>&1; then
      if netstat -ltn 2>/dev/null | grep -q ":8080 "; then
        printf "http://localhost:%s  ctrl-\\ to detach" "$port"
      fi
    else
      printf "http://localhost:%s  ctrl-\\ to detach" "$port"
    fi
    ;;
esac
